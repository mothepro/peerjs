/*! peerjs build:0.3.20, production. Copyright(c) 2013 Michelle Bu <michelle@michellebu.com> */!function e(t,n,o){function i(s,a){if(!n[s]){if(!t[s]){var c="function"==typeof require&&require;if(!a&&c)return c(s,!0);if(r)return r(s,!0);var d=new Error("Cannot find module '"+s+"'");throw d.code="MODULE_NOT_FOUND",d}var h=n[s]={exports:{}};t[s][0].call(h.exports,function(e){var n=t[s][1][e];return i(n||e)},h,h.exports,e,t,n,o)}return n[s].exports}for(var r="function"==typeof require&&require,s=0;s<o.length;s++)i(o[s]);return i}({1:[function(e,t,n){t.exports.RTCSessionDescription=window.RTCSessionDescription||window.mozRTCSessionDescription,t.exports.RTCPeerConnection=window.RTCPeerConnection||window.mozRTCPeerConnection||window.webkitRTCPeerConnection,t.exports.RTCIceCandidate=window.RTCIceCandidate||window.mozRTCIceCandidate},{}],2:[function(e,t,n){function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);r.call(this),this.open=!1,this.type="data",this.peer=e,this.provider=t,this.id=n.connectionId||o._idPrefix+i.randomToken(),this.label=n.label||this.id,this.metadata=n.metadata,this._buffer=[],this._buffering=!1,this.bufferSize=0,this._chunkedData={},n._payload&&(this._peerBrowser=n._payload.browser),s.startConnection(this,n._payload||{originator:!0})}var i=e("./util"),r=e("events"),s=e("./negotiator");i.inherits(o,r),o._idPrefix="dc_",o.prototype.initialize=function(e){this._dc=this.dataChannel=e,this._configureDataChannel()},o.prototype._configureDataChannel=function(){var e=this;i.supports.sctp&&(this._dc.binaryType="arraybuffer"),this._dc.onopen=function(){i.log("Data channel connection success"),e.open=!0,e.emit("open")},this._dc.onmessage=function(t){e._handleDataMessage(t)},this._dc.onclose=function(t){i.log("DataChannel closed for:",e.peer),e.close()}},o.prototype._handleDataMessage=function(e){var t=e.data;if(t.__peerData){var n=t.__peerData,o=this._chunkedData[n]||{data:[],count:0,total:t.total};return o.data[t.n]=t.data,o.count+=1,o.total===o.count&&(delete this._chunkedData[n],t=new Blob(o.data),this._handleDataMessage({data:t})),void(this._chunkedData[n]=o)}this.emit("data",t)},o.prototype.close=function(){this.open&&(this.open=!1,s.cleanup(this),this.emit("close"))},o.prototype.send=function(e,t){this.open?this._bufferedSend(e):this.emit("error",new Error("Connection is not open. You should listen for the `open` event before sending messages."))},o.prototype._bufferedSend=function(e){!this._buffering&&this._trySend(e)||(this._buffer.push(e),this.bufferSize=this._buffer.length)},o.prototype._trySend=function(e){try{this._dc.send(e)}catch(e){this._buffering=!0;var t=this;return setTimeout(function(){t._buffering=!1,t._tryBuffer()},100),!1}return!0},o.prototype._tryBuffer=function(){if(0!==this._buffer.length){var e=this._buffer[0];this._trySend(e)&&(this._buffer.shift(),this.bufferSize=this._buffer.length,this._tryBuffer())}},o.prototype._sendChunks=function(e){for(var t=i.chunk(e),n=0,o=t.length;n<o;n+=1){var e=t[n];this.send(e,!0)}},o.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":this._peerBrowser=t.browser,s.handleSDP(e.type,this,t.sdp);break;case"CANDIDATE":s.handleCandidate(this,t.candidate);break;default:i.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},t.exports=o},{"./negotiator":5,"./util":8,events:9}],3:[function(e,t,n){window.Socket=e("./socket"),window.MediaConnection=e("./mediaconnection"),window.DataConnection=e("./dataconnection"),window.Peer=e("./peer"),window.RTCPeerConnection=e("./adapter").RTCPeerConnection,window.RTCSessionDescription=e("./adapter").RTCSessionDescription,window.RTCIceCandidate=e("./adapter").RTCIceCandidate,window.Negotiator=e("./negotiator"),window.util=e("./util")},{"./adapter":1,"./dataconnection":2,"./mediaconnection":4,"./negotiator":5,"./peer":6,"./socket":7,"./util":8}],4:[function(e,t,n){function o(e,t,n){if(!(this instanceof o))return new o(e,t,n);r.call(this),this.options=i.extend({},n),this.open=!1,this.type="media",this.peer=e,this.provider=t,this.metadata=this.options.metadata,this.localStream=this.options._stream,this.id=this.options.connectionId||o._idPrefix+i.randomToken(),this.localStream&&s.startConnection(this,{_stream:this.localStream,originator:!0})}var i=e("./util"),r=e("events"),s=e("./negotiator");i.inherits(o,r),o._idPrefix="mc_",o.prototype.addStream=function(e){i.log("Receiving stream",e),this.remoteStream=e,this.emit("stream",e)},o.prototype.handleMessage=function(e){var t=e.payload;switch(e.type){case"ANSWER":s.handleSDP(e.type,this,t.sdp),this.open=!0;break;case"CANDIDATE":s.handleCandidate(this,t.candidate);break;default:i.warn("Unrecognized message type:",e.type,"from peer:",this.peer)}},o.prototype.answer=function(e){if(this.localStream)i.warn("Local stream already exists on this MediaConnection. Are you answering a call twice?");else{this.options._payload._stream=e,this.localStream=e,s.startConnection(this,this.options._payload);for(var t=this.provider._getMessages(this.id),n=0,o=t.length;n<o;n+=1)this.handleMessage(t[n]);this.open=!0}},o.prototype.close=function(){this.open&&(this.open=!1,s.cleanup(this),this.emit("close"))},t.exports=o},{"./negotiator":5,"./util":8,events:9}],5:[function(e,t,n){var o=e("./util"),i=e("./adapter").RTCPeerConnection,r=e("./adapter").RTCSessionDescription,s=e("./adapter").RTCIceCandidate,a={pcs:{data:{},media:{}},queue:[]};a._idPrefix="pc_",a.startConnection=function(e,t){var n=a._getPeerConnection(e,t);if("media"===e.type&&t._stream&&n.addStream(t._stream),e.pc=e.peerConnection=n,t.originator){if("data"===e.type){var i=n.createDataChannel(e.label,{reliable:!1});e.initialize(i)}o.supports.onnegotiationneeded||a._makeOffer(e)}else a.handleSDP("OFFER",e,t.sdp)},a._getPeerConnection=function(e,t){a.pcs[e.type]||o.error(e.type+" is not a valid connection type. Maybe you overrode the `type` property somewhere."),a.pcs[e.type][e.peer]||(a.pcs[e.type][e.peer]={});var n;a.pcs[e.type][e.peer];return t.pc&&(n=a.pcs[e.type][e.peer][t.pc]),n&&"stable"===n.signalingState||(n=a._startPeerConnection(e)),n},a._startPeerConnection=function(e){o.log("Creating RTCPeerConnection.");var t=a._idPrefix+o.randomToken(),n={};"data"!==e.type||o.supports.sctp?"media"===e.type&&(n={optional:[{DtlsSrtpKeyAgreement:!0}]}):n={optional:[{RtpDataChannels:!0}]};var r=new i(e.provider.options.config,n);return a.pcs[e.type][e.peer][t]=r,a._setupListeners(e,r,t),r},a._setupListeners=function(e,t,n){var i=e.peer,r=e.id,s=e.provider;o.log("Listening for ICE candidates."),t.onicecandidate=function(t){t.candidate&&(o.log("Received ICE candidates for:",e.peer),s.socket.send({type:"CANDIDATE",payload:{candidate:t.candidate,type:e.type,connectionId:e.id},dst:i}))},t.oniceconnectionstatechange=function(){switch(t.iceConnectionState){case"failed":o.log("iceConnectionState is disconnected, closing connections to "+i),e.emit("error",new Error("Negotiation of connection to "+i+" failed.")),e.close();break;case"disconnected":o.log("iceConnectionState is disconnected, closing connections to "+i),e.close();break;case"completed":t.onicecandidate=o.noop}},t.onicechange=t.oniceconnectionstatechange,o.log("Listening for `negotiationneeded`"),t.onnegotiationneeded=function(){o.log("`negotiationneeded` triggered"),"stable"==t.signalingState?a._makeOffer(e):o.log("onnegotiationneeded triggered when not stable. Is another connection being established?")},o.log("Listening for data channel"),t.ondatachannel=function(e){o.log("Received data channel");var t=e.channel;s.getConnection(i,r).initialize(t)},o.log("Listening for remote stream"),t.onaddstream=function(e){o.log("Received remote stream");var t=e.stream,n=s.getConnection(i,r);"media"===n.type&&n.addStream(t)}},a.cleanup=function(e){o.log("Cleaning up PeerConnection to "+e.peer);var t=e.pc;!t||"closed"===t.readyState&&"closed"===t.signalingState||(t.close(),e.pc=null)},a._makeOffer=function(e){var t=e.pc;t.createOffer(function(n){o.log("Created offer."),t.setLocalDescription(n,function(){o.log("Set localDescription: offer","for:",e.peer),e.provider.socket.send({type:"OFFER",payload:{sdp:n,type:e.type,label:e.label,connectionId:e.id,reliable:!1,serialization:e.serialization,metadata:e.metadata,browser:o.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),o.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),o.log("Failed to createOffer, ",t)},e.options.constraints)},a._makeAnswer=function(e){var t=e.pc;t.createAnswer(function(n){o.log("Created answer."),t.setLocalDescription(n,function(){o.log("Set localDescription: answer","for:",e.peer),e.provider.socket.send({type:"ANSWER",payload:{sdp:n,type:e.type,connectionId:e.id,browser:o.browser},dst:e.peer})},function(t){e.provider.emitError("webrtc",t),o.log("Failed to setLocalDescription, ",t)})},function(t){e.provider.emitError("webrtc",t),o.log("Failed to create answer, ",t)})},a.handleSDP=function(e,t,n){n=new r(n);var i=t.pc;o.log("Setting remote description",n),i.setRemoteDescription(n,function(){o.log("Set remoteDescription:",e,"for:",t.peer),"OFFER"===e&&a._makeAnswer(t)},function(e){t.provider.emitError("webrtc",e),o.log("Failed to setRemoteDescription, ",e)})},a.handleCandidate=function(e,t){var n=t.candidate,i=t.sdpMLineIndex;e.pc.addIceCandidate(new s({sdpMLineIndex:i,candidate:n})),o.log("Added ICE candidate for:",e.peer)},t.exports=a},{"./adapter":1,"./util":8}],6:[function(e,t,n){function o(e,t){if(!(this instanceof o))return new o(e,t);r.call(this),t=i.extend({debug:0,host:i.CLOUD_HOST,port:i.CLOUD_PORT,key:"peerjs",path:"/",token:i.randomToken(),config:i.defaultConfig},t),this.options=t,"/"===t.host&&(t.host=window.location.hostname),"/"!==t.path[0]&&(t.path="/"+t.path),"/"!==t.path[t.path.length-1]&&(t.path+="/"),void 0===t.secure&&t.host!==i.CLOUD_HOST&&(t.secure=i.isSecure()),t.logFunction&&i.setLogFunction(t.logFunction),i.setLogLevel(t.debug),i.supports.audioVideo||i.supports.data?i.validateId(e)?i.validateKey(t.key)?t.secure&&"0.peerjs.com"===t.host?this._delayedAbort("ssl-unavailable","The cloud server currently does not support HTTPS. Please run your own PeerServer to use HTTPS."):(this.destroyed=!1,this.disconnected=!1,this.open=!1,this.connections={},this._lostMessages={},this._initializeServerConnection(),this._initialize(e)):this._delayedAbort("invalid-key",'API KEY "'+t.key+'" is invalid'):this._delayedAbort("invalid-id",'ID "'+e+'" is invalid'):this._delayedAbort("browser-incompatible","The current browser does not support WebRTC")}var i=e("./util"),r=e("events"),s=e("./socket"),a=e("./mediaconnection"),c=e("./dataconnection");i.inherits(o,r),o.prototype._initializeServerConnection=function(){var e=this;this.socket=new s(this.options.secure,this.options.host,this.options.port,this.options.path,this.options.key),this.socket.on("message",function(t){e._handleMessage(t)}),this.socket.on("error",function(t){e._abort("socket-error",t)}),this.socket.on("disconnected",function(){e.disconnected||(e.emitError("network","Lost connection to server."),e.disconnect())}),this.socket.on("close",function(){e.disconnected||e._abort("socket-closed","Underlying socket is already closed.")})},o.prototype._initialize=function(e){this.id=e,this.socket.start(this.id,this.options.token)},o.prototype._handleMessage=function(e){var t,n=e.type,o=e.payload,r=e.src;switch(n){case"OPEN":this.emit("open",this.id),this.open=!0;break;case"ERROR":this._abort("server-error",o.msg);break;case"ID-TAKEN":this._abort("unavailable-id","ID `"+this.id+"` is taken");break;case"INVALID-KEY":this._abort("invalid-key",'API KEY "'+this.options.key+'" is invalid');break;case"LEAVE":i.log("Received leave message from",r),this._cleanupPeer(r);break;case"EXPIRE":this.emitError("peer-unavailable","Could not connect to peer "+r);break;case"OFFER":var s=o.connectionId;if(t=this.getConnection(r,s))i.warn("Offer received for existing Connection ID:",s);else{if("media"===o.type)t=new a(r,this,{connectionId:s,_payload:o,metadata:o.metadata}),this._addConnection(r,t),this.emit("call",t);else{if("data"!==o.type)return void i.warn("Received malformed connection type:",o.type);t=new c(r,this,{connectionId:s,_payload:o,metadata:o.metadata,label:o.label,serialization:o.serialization,reliable:o.reliable}),this._addConnection(r,t),this.emit("connection",t)}for(var d=this._getMessages(s),h=0,l=d.length;h<l;h+=1)t.handleMessage(d[h])}break;default:if(!o)return void i.warn("You received a malformed message from "+r+" of type "+n);var p=o.connectionId;(t=this.getConnection(r,p))&&t.pc?t.handleMessage(e):p?this._storeMessage(p,e):i.warn("You received an unrecognized message:",e)}},o.prototype._storeMessage=function(e,t){this._lostMessages[e]||(this._lostMessages[e]=[]),this._lostMessages[e].push(t)},o.prototype._getMessages=function(e){var t=this._lostMessages[e];return t?(delete this._lostMessages[e],t):[]},o.prototype.connect=function(e,t){if(this.disconnected)return i.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect, or call reconnect on this peer if you believe its ID to still be available."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");var n=new c(e,this,t);return this._addConnection(e,n),n},o.prototype.call=function(e,t,n){if(this.disconnected)return i.warn("You cannot connect to a new Peer because you called .disconnect() on this Peer and ended your connection with the server. You can create a new Peer to reconnect."),void this.emitError("disconnected","Cannot connect to new Peer after disconnecting from server.");{if(t){(n=n||{})._stream=t;var o=new a(e,this,n);return this._addConnection(e,o),o}i.error("To call a peer, you must provide a stream from your browser's `getUserMedia`.")}},o.prototype._addConnection=function(e,t){this.connections[e]||(this.connections[e]=[]),this.connections[e].push(t)},o.prototype.getConnection=function(e,t){var n=this.connections[e];if(!n)return null;for(var o=0,i=n.length;o<i;o++)if(n[o].id===t)return n[o];return null},o.prototype._delayedAbort=function(e,t){var n=this;i.setZeroTimeout(function(){n._abort(e,t)})},o.prototype._abort=function(e,t){i.error("Aborting!"),this._lastServerId?this.disconnect():this.destroy(),this.emitError(e,t)},o.prototype.emitError=function(e,t){i.error("Error:",t),"string"==typeof t&&(t=new Error(t)),t.type=e,this.emit("error",t)},o.prototype.destroy=function(){this.destroyed||(this._cleanup(),this.disconnect(),this.destroyed=!0)},o.prototype._cleanup=function(){if(this.connections)for(var e=Object.keys(this.connections),t=0,n=e.length;t<n;t++)this._cleanupPeer(e[t]);this.emit("close")},o.prototype._cleanupPeer=function(e){for(var t=this.connections[e],n=0,o=t.length;n<o;n+=1)t[n].close()},o.prototype.disconnect=function(){var e=this;i.setZeroTimeout(function(){e.disconnected||(e.disconnected=!0,e.open=!1,e.socket&&e.socket.close(),e.emit("disconnected",e.id),e._lastServerId=e.id,e.id=null)})},o.prototype.reconnect=function(){if(this.disconnected&&!this.destroyed)i.log("Attempting reconnection to server with ID "+this._lastServerId),this.disconnected=!1,this._initializeServerConnection(),this._initialize(this._lastServerId);else{if(this.destroyed)throw new Error("This peer cannot reconnect to the server. It has already been destroyed.");if(this.disconnected||this.open)throw new Error("Peer "+this.id+" cannot reconnect because it is not disconnected from the server!");i.error("In a hurry? We're still trying to make the initial connection!")}},o.prototype.listAllPeers=function(e){e=e||function(){};var t=this,n=new XMLHttpRequest,o=(this.options.secure?"https://":"http://")+this.options.host+":"+this.options.port+this.options.path+this.options.key+"/peers";o+="?ts="+(new Date).getTime()+Math.random(),n.open("get",o,!0),n.onerror=function(n){t._abort("server-error","Could not get peers from the server."),e([])},n.onreadystatechange=function(){if(4===n.readyState){if(401===n.status){var o="";throw o=t.options.host!==i.CLOUD_HOST?"It looks like you're using the cloud server. You can email team@peerjs.com to enable peer listing for your API key.":"You need to enable `allow_discovery` on your self-hosted PeerServer to use this feature.",e([]),new Error("It doesn't look like you have permission to list peers IDs. "+o)}e(200!==n.status?[]:JSON.parse(n.responseText))}},n.send(null)},t.exports=o},{"./dataconnection":2,"./mediaconnection":4,"./socket":7,"./util":8,events:9}],7:[function(e,t,n){function o(e,t,n,i,s){if(!(this instanceof o))return new o(e,t,n,i,s);r.call(this),this.disconnected=!1,this._queue=[];var a=e?"https://":"http://",c=e?"wss://":"ws://";this._httpUrl=a+t+":"+n+i+s,this._wsUrl=c+t+":"+n+i+"peerjs?key="+s}var i=e("./util"),r=e("events");i.inherits(o,r),o.prototype.start=function(e,t){this.id=e,this._httpUrl+="/"+e+"/"+t,this._wsUrl+="&id="+e+"&token="+t,this._startXhrStream(),this._startWebSocket()},o.prototype._startWebSocket=function(e){var t=this;this._socket||(this._socket=new WebSocket(this._wsUrl),this._socket.onmessage=function(e){try{var n=JSON.parse(e.data)}catch(t){return void i.log("Invalid server message",e.data)}t.emit("message",n)},this._socket.onclose=function(e){i.log("Socket closed."),t.disconnected=!0,t.emit("disconnected")},this._socket.onopen=function(){t._timeout&&(clearTimeout(t._timeout),setTimeout(function(){t._http.abort(),t._http=null},5e3)),t._sendQueuedMessages(),i.log("Socket open")})},o.prototype._startXhrStream=function(e){try{var t=this;this._http=new XMLHttpRequest,this._http._index=1,this._http._streamIndex=e||0,this._http.open("post",this._httpUrl+"/id?i="+this._http._streamIndex,!0),this._http.onerror=function(){clearTimeout(t._timeout),t.emit("disconnected")},this._http.onreadystatechange=function(){2==this.readyState&&this.old?(this.old.abort(),delete this.old):this.readyState>2&&200===this.status&&this.responseText&&t._handleStream(this)},this._http.send(null),this._setHTTPTimeout()}catch(e){i.log("XMLHttpRequest not available; defaulting to WebSockets")}},o.prototype._handleStream=function(e){var t=e.responseText.split("\n");if(e._buffer)for(;e._buffer.length>0;){var n=e._buffer.shift(),o=t[n];try{o=JSON.parse(o)}catch(t){e._buffer.shift(n);break}this.emit("message",o)}var r=t[e._index];if(r)if(e._index+=1,e._index===t.length)e._buffer||(e._buffer=[]),e._buffer.push(e._index-1);else{try{r=JSON.parse(r)}catch(e){return void i.log("Invalid server message",r)}this.emit("message",r)}},o.prototype._setHTTPTimeout=function(){var e=this;this._timeout=setTimeout(function(){var t=e._http;e._wsOpen()?t.abort():(e._startXhrStream(t._streamIndex+1),e._http.old=t)},25e3)},o.prototype._wsOpen=function(){return this._socket&&1==this._socket.readyState},o.prototype._sendQueuedMessages=function(){for(var e=0,t=this._queue.length;e<t;e+=1)this.send(this._queue[e])},o.prototype.send=function(e){if(!this.disconnected)if(this.id)if(e.type){var t=JSON.stringify(e);if(this._wsOpen())this._socket.send(t);else{var n=new XMLHttpRequest,o=this._httpUrl+"/"+e.type.toLowerCase();n.open("post",o,!0),n.setRequestHeader("Content-Type","application/json"),n.send(t)}}else this.emit("error","Invalid message");else this._queue.push(e)},o.prototype.close=function(){!this.disconnected&&this._wsOpen()&&(this._socket.close(),this.disconnected=!0)},t.exports=o},{"./util":8,events:9}],8:[function(e,t,n){var o={iceServers:[{url:"stun:stun.l.google.com:19302"}]},i=1,r=e("./adapter").RTCPeerConnection,s={noop:function(){},CLOUD_HOST:"0.peerjs.com",CLOUD_PORT:9e3,chunkedBrowsers:{Chrome:1},chunkedMTU:16300,logLevel:0,setLogLevel:function(e){var t=parseInt(e,10);isNaN(parseInt(e,10))?s.logLevel=e?3:0:s.logLevel=t,s.log=s.warn=s.error=s.noop,s.logLevel>0&&(s.error=s._printWith("ERROR")),s.logLevel>1&&(s.warn=s._printWith("WARNING")),s.logLevel>2&&(s.log=s._print)},setLogFunction:function(e){e.constructor!==Function?s.warn("The log function you passed in is not a function. Defaulting to regular logs."):s._print=e},_printWith:function(e){return function(){var t=Array.prototype.slice.call(arguments);t.unshift(e),s._print.apply(s,t)}},_print:function(){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,o=t.length;n<o;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)},defaultConfig:o,browser:window.mozRTCPeerConnection?"Firefox":window.webkitRTCPeerConnection?"Chrome":window.RTCPeerConnection?"Supported":"Unsupported",supports:function(){if(void 0===r)return{};var e,t,n=!0,i=!0,a=!1,c=!1,d=!!window.webkitRTCPeerConnection;try{e=new r(o,{optional:[{RtpDataChannels:!0}]})}catch(e){n=!1,i=!1}if(n)try{t=e.createDataChannel("_PEERJSTEST")}catch(e){n=!1}if(n){try{t.binaryType="blob",a=!0}catch(e){}var h=new r(o,{});try{c=h.createDataChannel("_PEERJSRELIABLETEST",{}).reliable}catch(e){}h.close()}if(i&&(i=!!e.addStream),!d&&n){var l=new r(o,{optional:[{RtpDataChannels:!0}]});l.onnegotiationneeded=function(){d=!0,s&&s.supports&&(s.supports.onnegotiationneeded=!0)},l.createDataChannel("_PEERJSNEGOTIATIONTEST"),setTimeout(function(){l.close()},1e3)}return e&&e.close(),{audioVideo:i,data:n,binaryBlob:a,binary:c,reliable:c,sctp:c,onnegotiationneeded:d}}(),validateId:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},validateKey:function(e){return!e||/^[A-Za-z0-9]+(?:[ _-][A-Za-z0-9]+)*$/.exec(e)},debug:!1,inherits:function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})},extend:function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e},log:function(){if(s.debug){var e=!1,t=Array.prototype.slice.call(arguments);t.unshift("PeerJS: ");for(var n=0,o=t.length;n<o;n++)t[n]instanceof Error&&(t[n]="("+t[n].name+") "+t[n].message,e=!0);e?console.error.apply(console,t):console.log.apply(console,t)}},setZeroTimeout:function(e){function t(t){t.source==e&&t.data==o&&(t.stopPropagation&&t.stopPropagation(),n.length&&n.shift()())}var n=[],o="zero-timeout-message";return e.addEventListener?e.addEventListener("message",t,!0):e.attachEvent&&e.attachEvent("onmessage",t),function(t){n.push(t),e.postMessage(o,"*")}}(window),chunk:function(e){for(var t=[],n=e.size,o=index=0,r=Math.ceil(n/s.chunkedMTU);o<n;){var a=Math.min(n,o+s.chunkedMTU),c=e.slice(o,a),d={__peerData:i,n:index,data:c,total:r};t.push(d),o=a,index+=1}return i+=1,t},blobToArrayBuffer:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsArrayBuffer(e)},blobToBinaryString:function(e,t){var n=new FileReader;n.onload=function(e){t(e.target.result)},n.readAsBinaryString(e)},binaryStringToArrayBuffer:function(e){for(var t=new Uint8Array(e.length),n=0;n<e.length;n++)t[n]=255&e.charCodeAt(n);return t.buffer},randomToken:function(){return Math.random().toString(36).substr(2)},isSecure:function(){return"https:"===location.protocol}};t.exports=s},{"./adapter":1}],9:[function(e,t,n){function o(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function r(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=o,o.EventEmitter=o,o.prototype._events=void 0,o.prototype._maxListeners=void 0,o.defaultMaxListeners=10,o.prototype.setMaxListeners=function(e){if(!r(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},o.prototype.emit=function(e){var t,n,o,r,c,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;throw TypeError('Uncaught, unspecified "error" event.')}if(n=this._events[e],a(n))return!1;if(i(n))switch(arguments.length){case 1:n.call(this);break;case 2:n.call(this,arguments[1]);break;case 3:n.call(this,arguments[1],arguments[2]);break;default:for(o=arguments.length,r=new Array(o-1),c=1;c<o;c++)r[c-1]=arguments[c];n.apply(this,r)}else if(s(n)){for(o=arguments.length,r=new Array(o-1),c=1;c<o;c++)r[c-1]=arguments[c];for(o=(d=n.slice()).length,c=0;c<o;c++)d[c].apply(this,r)}return!0},o.prototype.addListener=function(e,t){if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;(n=a(this._maxListeners)?o.defaultMaxListeners:this._maxListeners)&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace())}return this},o.prototype.on=o.prototype.addListener,o.prototype.once=function(e,t){function n(){this.removeListener(e,n),o||(o=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var o=!1;return n.listener=t,this.on(e,n),this},o.prototype.removeListener=function(e,t){var n,o,r,a;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(n=this._events[e],r=n.length,o=-1,n===t||i(n.listener)&&n.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(n)){for(a=r;a-- >0;)if(n[a]===t||n[a].listener&&n[a].listener===t){o=a;break}if(o<0)return this;1===n.length?(n.length=0,delete this._events[e]):n.splice(o,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},o.prototype.removeAllListeners=function(e){var t,n;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n=this._events[e],i(n))this.removeListener(e,n);else for(;n.length;)this.removeListener(e,n[n.length-1]);return delete this._events[e],this},o.prototype.listeners=function(e){return this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},o.listenerCount=function(e,t){return e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}]},{},[3]);